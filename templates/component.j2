# '{{ module_meta.name }}' component {{ ansible_managed }}

{% set module_name = (module_meta.name | replace('-', '_')) %}
{% for key, value in variables.iteritems() %}
variable "{{ module_name }}_{{ key }}" {}
{% endfor %}

module "{{ module_meta.name }}" {
  source {{ ' ' * 23 }} = "{{ modules_path }}/{{ module_meta.path | default(module_meta.name) }}"

{% for key, value in variables.iteritems() %}
  {{ key }}{{ ' ' * (30 - (key | length)) }} = "${var.{{ module_name }}_{{ key }}}"
{% endfor %}

{% for key, value in remote_state_vars.iteritems() %}
{% set key_pad = key + (' ' * (30 - (key | length))) %}
{% if value.reference is iterable and value.reference is not string %}
  {{ key_pad }} = [{% for xvalue in value.reference %}"${data.terraform_remote_state.{{ xvalue }}}",{% endfor %}]
{% elif value.reference.split('.') | length == 1 %}
  {{ key_pad }} = "${data.terraform_remote_state.{{ value.reference }}.{{ key }}}"
{% else %}
  {{ key_pad }} = "${data.terraform_remote_state.{{ value.reference }}}"
{% endif %}
{% endfor %}
}
{% for key, value in output_vars.iteritems() %}

output "{{ key }}" {
  description = "{{ value.description }}"
  value       = "${module.{{ module_meta.name }}.{{ key }}}"
}
{% endfor %}
